p8105\_mtp\_zdz2101
================
Zelos Zhu
10/22/2018

Load packages
-------------

``` r
library(tidyverse)
```

    ## ── Attaching packages ─────────────────────────────────────────────────────────────────────────────────────────────────── tidyverse 1.2.1 ──

    ## ✔ ggplot2 3.0.0     ✔ purrr   0.2.5
    ## ✔ tibble  1.4.2     ✔ dplyr   0.7.6
    ## ✔ tidyr   0.8.1     ✔ stringr 1.3.1
    ## ✔ readr   1.1.1     ✔ forcats 0.3.0

    ## ── Conflicts ────────────────────────────────────────────────────────────────────────────────────────────────────── tidyverse_conflicts() ──
    ## ✖ dplyr::filter() masks stats::filter()
    ## ✖ dplyr::lag()    masks stats::lag()

``` r
library(readr)
library(wordcountaddin)
library(patchwork)
wordcountaddin::text_stats("p8105_mtp_zdz2101.Rmd")
```

| Method          | koRpus      | stringi       |
|:----------------|:------------|:--------------|
| Word count      | 761         | 715           |
| Character count | 4148        | 4147          |
| Sentence count  | 36          | Not available |
| Reading time    | 3.8 minutes | 3.6 minutes   |

Read data/tidying
-----------------

``` r
accelero_data <- read_csv("data/p8105_mtp_data.csv") %>%
  gather(., key = "activity", value = "activity_value", 3:1442) %>%
  mutate(day = factor(day, levels = c("Sunday", "Monday", "Tuesday", "Wednesday", "Thursday", "Friday", "Saturday")),
         day_id = (7 * week) - (abs(as.numeric(day) - 7)),
         minute = as.numeric(str_replace_all(activity, "activity.","")),
         hour = floor((minute-1)/60)) %>%
  select(day_id, week, day, hour, activity, minute, activity_value) %>%
  arrange(week,day)

sample_n(accelero_data, 10)  #show that day_id is works
```

    ## # A tibble: 10 x 7
    ##    day_id  week day        hour activity      minute activity_value
    ##     <dbl> <int> <fct>     <dbl> <chr>          <dbl>          <dbl>
    ##  1    143    21 Tuesday      19 activity.1197   1197          425. 
    ##  2     49     7 Saturday     13 activity.824     824            1  
    ##  3     76    11 Friday       17 activity.1070   1070            1  
    ##  4    313    45 Thursday     19 activity.1180   1180          458. 
    ##  5    144    21 Wednesday    19 activity.1164   1164           43.0
    ##  6    298    43 Wednesday    10 activity.611     611           11.0
    ##  7    155    23 Sunday       16 activity.988     988          150. 
    ##  8    112    16 Saturday      1 activity.90       90            1  
    ##  9    129    19 Tuesday       5 activity.343     343            1  
    ## 10     70    10 Saturday      3 activity.193     193            1

``` r
#I cleverly used a linear transform of week and a numeric version of day to attain day_id
```

The final dataset I have attained has 473760 observations and 7 variables. The number of observations was as expected as there are 60 minutes in an hour, 24 hours a day, 7 days a week, and 47 weeks worth of accelerometer readings, in which case the product of these 4 numbers gets you 473760. My variables are as follows:

1.  **day\_id**: Identifies the day of the study with the assumption that sunday is the beginning of a week, so week 1 sunday is day 1, week 2 sunday is day 8, etc.
2.  **week**: Identifies what week of the study this patient was wearing the accelerometer
3.  **day**: Identifies what weekday it is, which I recoded to as a factor
4.  **hour**: Identifies what hour of the day it is (24 hour/military time)
5.  **activity**: A column of essentially the column names of the original file, this was my "key" for when using the gather function, I left it as is to "preserve the original observations"
6.  **minute**: Identifies minute of day 1 being 12:00 - 12:01 AM, 1440 being 11:59 PM - 12:00 AM
7.  **activity\_value**: The accelerometer activity reading for a particular moment in time

Aggregate data by day and discover some trends
==============================================

``` r
day_aggregate_df <- accelero_data %>%
  group_by(day_id, week, day) %>%
  summarize(total_activity = sum(activity_value),
            mean = mean(activity_value),
            min = quantile(activity_value, 0),
            q1 = quantile(activity_value, 0.25),
            median = quantile(activity_value, 0.50),
            q3 = quantile(activity_value, 0.75),
            max = quantile(activity_value, 1)
            )
  

day_aggregate_plot <- day_aggregate_df %>%
  filter(total_activity != 1440) %>% #----------get rid of days with presumably invalid readings
  ggplot(., aes(x = day_id, y = total_activity)) + 
  geom_point(aes(color = day), alpha = 0.5) + 
  geom_smooth() +
  ylab("Total Activity") +
  xlab("Day of Study") + 
  theme(legend.position = "bottom") +
  ggtitle("Total activity measure by each day of study") + 
  theme(axis.text = element_text(size = 16),
        axis.title = element_text(size = 18),
        plot.title = element_text(size = 20, face = "bold"),
        legend.title=element_text(size=14), 
        legend.text=element_text(size=14))

by_day_plot <- day_aggregate_df %>%
  filter(total_activity != 1440) %>%
  ggplot(., aes(x = day_id, y = total_activity, color = day)) + 
  geom_point(alpha = 0.5) + 
  geom_smooth() + 
  ylab("Total Activity") +
  xlab("Day of Study") + 
  theme(legend.position = "none") +
  ggtitle("Total activity measure by weekday") +
  theme(axis.text = element_text(size = 16),
        axis.title = element_text(size = 18),
        plot.title = element_text(size = 20, face = "bold"),
        strip.text = element_text(size = 14)) +
  facet_wrap(~day, nrow = 2)

day_aggregate_plot + by_day_plot
```

![](p8105_mtp_zdz2101_files/figure-markdown_github/Aggregate%20by%20day-1.png)

Using the sum of the 1440 readings on a given day (our Total Activity measure), as shown by the figure on the left, it is clear there is an upward trend in activity throughout the course of the study. It looks like there was an ever so slight dip ~day 150, about week 21-22, but the trend over the course of the 47 weeks is still that of which is overall increasing. Based on the figure on the right, weekday does not seem to play any big role in this finding as the patient's activity seemed to still increase over time regardless of what day it was. Though it could be argued the patient's activity on Thursdays looks a little stagnant.

It is interesting to note during the exploratory phase of this, I discovered 18 days: day\_id's 7, 8, 15, 18, 19, 20, 23, 25, 26, 27, 55, 78, 83, 84, 86, 133, 140, 219 where the total activity measure read "1440" which meant that there was no activity over the course of an entire day. I removed these days from the figures as it probably meant the patient was not wearing/using the accelerometer for that day or the accelerometer malfunctioned somehow. I suspect this is true for a few more days but establishing a particular cutoff seems difficult.

``` r
hour_aggregate <- accelero_data %>%
  group_by(day_id, week, day, hour) %>%
  summarize(hourly_activity_total = sum(activity_value),
            hourly_activity_mean = mean(activity_value)) %>%
  mutate(sleep = ifelse(hour %in% c(0:6,23), "asleep", "awake"))

ggplot(hour_aggregate, aes(x = as.factor(hour), y = hourly_activity_total, color = sleep)) +
  geom_boxplot() + 
  xlab("Hour of the Day") + 
  ylab("Total Activity") +
  ggtitle("Boxplot of total activity based on hour-by-hour profiles") +
  theme(axis.text = element_text(size = 16),
        axis.title = element_text(size = 18),
        plot.title = element_text(size = 20, face = "bold"),
        strip.text = element_text(size = 14))
```

![](p8105_mtp_zdz2101_files/figure-markdown_github/Aggregate%20by%20hour/%22activity%20profiles%22-1.png)

Given this datazet, it only seemed logical to visualize the data by hours of the day to get an idea of when our patient is actually awake and doing things. Based on this figure and an assumption that an adult sleeps 8 hours a day, I colored the boxplots with the 8 lowest medians a different color to signify "sleep" hours. It seems our patient here is a relatively normal adult: gets his day started around 7-8am, ramps up his activities which stabilizes from about 10am until 8pm or so, then begins to "wind down" his day and is asleep by 11pm.

``` r
top_one_percent <- quantile(accelero_data$activity_value, 0.99)

peaks_df<- accelero_data %>%
  filter(activity_value > top_one_percent) %>%
  select(day_id, hour, minute, activity_value) %>%
  group_by(day_id) %>%
  arrange(day_id, minute)

peak_times_plot <- ggplot(peaks_df, aes(x = minute, y = activity_value, color = as.factor(day_id))) +
  geom_line() + 
  scale_x_continuous(breaks = seq(1,1440,60), labels = 0:23) + 
  xlab("Hour of the Day") +
  ylab("Activity Value") +
  ggtitle("Spaghetti plot of Top 1% of Accelerometer Readings") +
  theme(axis.text = element_text(size = 16),
        axis.title = element_text(size = 18),
        plot.title = element_text(size = 20, face = "bold"),
        strip.text = element_text(size = 14)) +
  geom_hline(yintercept =  3000, color = "black", linetype = "dashed") +
  theme(legend.position="none")

exercise_df <- peaks_df %>%
  filter(activity_value > 3000) %>%
  mutate(study = ifelse(day_id > 165, "Second Half", "First Half"))

study_half_props <- exercise_df %>%
  group_by(study) %>%
  count()

exercise_hyp_plot <- ggplot(exercise_df, aes(x = minute, y = activity_value, color = study)) + 
  geom_jitter(alpha = 0.5) + 
  scale_x_continuous(breaks = seq(1,1440,60), labels = 0:23) + 
  xlab("Hour of Day") +
  ylab("Activity Level") + 
  ggtitle("Scatter plot of top readings based on two periods") +
  theme(axis.text = element_text(size = 16),
        axis.title = element_text(size = 18),
        plot.title = element_text(size = 20, face = "bold"),
        strip.text = element_text(size = 14)) +
  facet_grid(~study)

peak_times_plot/exercise_hyp_plot
```

![](p8105_mtp_zdz2101_files/figure-markdown_github/Finding%20peak%20times-1.png)

In an attempt to track exercise, I took the assumption that the highest 1% of activity occurs during the patient's exercise time. Based on the top figure where each "spaghetti" line was meant to distinguish a particular day, it is clear there was a lot of "noise" below the activity level ~3000 (1% surely was not conservative enough).

I tried something else where I filtered for readings above 3000, an arugment can be made to increase or decrease this seemingly arbitrary cutoff. As a result I rendered the bottom figure, a scatter plot of activity values against time of day where the left panel is data from the first half of the study (days 1 - 165), and the right panel is data from the second half of the study (days 165 - 329). Based on this plot, I suspect the patient likes to work out during three time zones: 11am - 1pm, 3pm - 6pm or around 8pm. This 3pm - 6pm slot became **much** more popular by the end of the study, if not an additional time dedicated to exercise. It even seems based on the sheer number of points in the second half compared to the first half, the patient seems to just be exercising more and pushing himself harder to higher levels of activity. Among the 943 instances where the patient had an activity level above 3000, 62.6 % of those instances were in the second half of the study, compared to 37.4 %.
